##############################
## GM1 script_values
##############################

# based on ./common/script_values/05/bp2_hostage_values.txt/hostage_value
base_ransom_value = {
	value = 0
	if = {
		limit = { gold >= half_increased_ransom_cost_value }
		add = half_increased_ransom_cost_value
	}
	else_if = {
		limit = { gold >= half_ransom_cost_value }
		add = half_ransom_cost_value
	}
	else = { 
		add = current_gold_value
	}
}

# based on ./common/script_values/05/bp2_hostage_values.txt/hostage_value
base_prisoner_value = {
	value = scope:prisoner.base_ransom_value

	### Dynasty Level Difference
	if = {
		limit = {
			scope:prisoner = { exists = dynasty }
			scope:imprisoner = { exists = dynasty }
			scope:prisoner.dynasty.dynasty_prestige_level > scope:imprisoner.dynasty.dynasty_prestige_level
		}
		add = {
			value = 20
			multiply = {
				value = scope:prisoner.dynasty.dynasty_prestige_level
				subtract = scope:imprisoner.dynasty.dynasty_prestige_level
				min = 1
			}
		}
	}
	if = {
		limit = {
			scope:prisoner = { exists = dynasty }
			scope:imprisoner = { exists = dynasty }
			scope:prisoner.dynasty.dynasty_prestige_level < scope:imprisoner.dynasty.dynasty_prestige_level
		}
		add = {
			value = -20
			multiply = {
				value = scope:imprisoner.dynasty.dynasty_prestige_level
				subtract = scope:prisoner.dynasty.dynasty_prestige_level
				min = 1
			}
		}
	}
	### Tier Level Difference
	if = {
		limit = {
			scope:prisoner.highest_held_title_tier > scope:imprisoner.highest_held_title_tier
		}
		add = {
			value = 20
			multiply = {
				value = scope:prisoner.highest_held_title_tier
				subtract = scope:imprisoner.highest_held_title_tier
				min = 1
			}
		}
	}
	if = {
		limit = {
			scope:prisoner.highest_held_title_tier < scope:imprisoner.highest_held_title_tier
		}
		add = {
			value = -20
			multiply = {
				value = scope:imprisoner.highest_held_title_tier
				subtract = scope:prisoner.highest_held_title_tier
				min = 1
			}
		}
	}
	### Prestige Level Difference
	if = {
		limit = {
			scope:prisoner.prestige_level > scope:imprisoner.prestige_level
		}
		add = {
			value = 20
			multiply = {
				value = scope:prisoner.prestige_level
				subtract = scope:imprisoner.prestige_level
				min = 1
			}
		}
	}
	if = {
		limit = {
			scope:prisoner.prestige_level < scope:imprisoner.prestige_level
		}
		add = {
			value = -20
			multiply = {
				value = scope:imprisoner.prestige_level
				subtract = scope:prisoner.prestige_level
				min = 1
			}
		}
	}
	### Prisoner Independece
	if = {
		limit = {
			scope:prisoner = { is_independent_ruler = yes }
		}
		add = 10
	}
	else = {
		add = {
			value = 10
			multiply = -1
		}
	}
	### Prisoner Neighboring
	if = {
		limit = {
			scope:prisoner = { character_is_land_realm_neighbor = scope:imprisoner }
		}
		add = 10
	}
	else = {
		add = {
			value = 20
			multiply = -1
		}
	}
	### Prisoner is their liege.
	if = {
		limit = { scope:imprisoner = { is_vassal_of = scope:prisoner } }
		add = -50
	}
	## Prisoner is their direct vassal.
	if = {
		limit = { scope:prisoner = { is_vassal_of = scope:imprisoner } }
		add = {
			value = -20
			if = {
				limit = { scope:receiver = { has_imprisonment_reason = scope:prisoner } }
				multiply = -1
			}
		}
	}
	## Prisoner is their powerful vassal.
	if = {
		limit = { scope:prisoner = { is_powerful_vassal_of = scope:imprisoner } }
		add = {
			value = -40
			if = {
				limit = { scope:receiver = { has_imprisonment_reason = scope:prisoner } }
				multiply = -1
			}
		}
	}
	### Both are close in power.
	if = {
		limit = {
			NOR = {
				scope:imprisoner.interaction_current_strength_ninety_percent_value > scope:prisoner.current_military_strength
				scope:imprisoner.current_military_strength < scope:prisoner.interaction_current_strength_ninety_percent_value
			}
		}
		add = -10
	}
	### Prisoner is more powerful.
	if = {
		limit = {
			scope:prisoner.interaction_current_strength_ninety_percent_value > scope:imprisoner.current_military_strength
		}
		add = {
			value = scope:prisoner.current_military_strength 		# 1828
			divide = {
				value = scope:imprisoner.current_military_strength	# 1382
				min = 1
			}														# 1828 / 1382 = 1.32
			subtract = 1									 		# 1.32 - 1 = 0.32
			multiply = -50 											# 0.32 * -50 = -16
			max = 50
			min = -50
		}
	}
	### Prisoner is less powerful.
	if = {
		limit = {
			scope:prisoner.current_military_strength < scope:imprisoner.interaction_current_strength_ninety_percent_value
		}
		add = {
			value = scope:imprisoner.current_military_strength 		# 1828
			divide = {
				value = scope:prisoner.current_military_strength	# 1382
				min = 1
			}														# 1828 / 1382 = 1.32
			subtract = 1									 		# 1.32 - 1 = 0.32
			multiply = 50 											# 0.32 * 50 = 16
			max = 50
			min = -50
		}
	}
	### Both allies' Military Strength
	if = {
		limit = {
			#### Some allies must exist.
			OR = {
				scope:prisoner = { any_ally = { exists = this } }
				scope:imprisoner = { any_ally = { exists = this } }
			}
			#### Strength with allies must be greater than enemies base strength.
			OR = {
				scope:prisoner.interaction_current_strength_with_allies_value >= scope:imprisoner.interaction_current_strength_ninety_percent_value
				scope:imprisoner.interaction_current_strength_with_allies_value >= scope:prisoner.interaction_current_strength_ninety_percent_value
			}
		}
		add = {
			value = {
				value = 0
				scope:imprisoner = {
					every_ally = { add = current_military_strength } 		# 1828
				}
			}
			divide = {
				value = {
					value = 0
					scope:prisoner = {
						every_ally = { add = current_military_strength } 	# 1382
					}
				}
				min = 1
			}																# 1828 / 1382 = 1.32
			subtract = 1 													# 1.32 - 1 = 0.32
			multiply = -100													# 0.32 * 100 = -32
			divide = 2 														# -32 / 2 = -16
			max = 25
			min = -25
		}
	}
	### Receiver have casus belli against the prisoner.
	#### They can't wage war against their own prisoner
	if = {
		limit = { scope:imprisoner = { has_any_cb_on = scope:prisoner } }
		add = {
			value = 15
			if = {
				limit = { NOT = { is_at_war_with = scope:prisoner } }
				multiply = -1
			}
		}
	}
	### They have claims against the prisoner
	if = {
		limit = {
			scope:imprisoner = {
				has_claim_on_held_title_trigger = {
					CHARACTER = scope:prisoner
				}
			}
		}
		add = {
			value = 0
			scope:prisoner = {
				every_held_title = {
					limit = { scope:imprisoner = { has_claim_on = prev } }
					add = {
						value = 5
						#### Strong claims are worth more.
						if = {
							limit = { scope:imprisoner = { has_strong_claim_on = prev } }
							multiply = 2
						}
						#### Higher titles are worth more.
						multiply = {
								value = tier
							subtract = 1
							min = 1
						}
					}
				}
			}
		}
	}
}

# based on ./common/script_values/05/bp2_hostage_values.txt/interaction_actor_hostage_value
gm1_offer_prisoner_value = {
	value = 0
	if = {
		limit = { exists = scope:secondary_actor }
		scope:recipient = { 
			save_temporary_scope_as = imprisoner
		}
		scope:secondary_actor ?= {
			save_temporary_scope_as = prisoner
		}
		add = scope:prisoner.base_prisoner_value
		ceiling = yes
	}
}

# based on ./common/script_values/05/bp2_hostage_values.txt/interaction_recipient_hostage_value
gm1_demand_prisoner_value = {
	value = 0
	if = {
		limit = { exists = scope:secondary_recipient }
		scope:actor = { 
			save_temporary_scope_as = imprisoner
		}
		scope:secondary_recipient ?= {
			save_temporary_scope_as = prisoner
		}
		add = scope:prisoner.base_prisoner_value
		ceiling = yes
	}
}