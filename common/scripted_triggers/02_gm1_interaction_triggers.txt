##############################
## GM1 scripted_triggers
##############################
#------------------------------
# interaction-related
#------------------------------

# ROOT (character)
# SENDER (character)
gm1_valid_for_transfer_prisoner_interaction_trigger = {
	is_imprisoned = yes
	is_imprisoned_by = $SENDER$
	cannot_release_former_regent_whilst_old_regent_holds_power_trigger = {
		PRISONER = this
		REGENT = this.var:imprisoned_by_diarch
	}
}

# ROOT (character)
# This is basically for tooltip.
gm1_valid_for_transfer_prisoner_interaction_trigger_basic = {
	is_under_ongoing_interaction = no
	is_being_tortured = no
	health > dying_health
}

# ROOT
# SENDER
# RECEIVER
gm1_valid_for_transfer_prisoner_interaction_trigger_highlighted = {
	gm1_valid_for_transfer_prisoner_interaction_trigger = {
		SENDER = $SENDER$
	}
	gm1_valid_for_transfer_prisoner_interaction_trigger_basic = yes

	$RECEIVER$ = {
		OR = {
			is_at_war_with = prev
			AND = {
				has_revoke_title_reason = prev
				has_claim_on_held_title_trigger = {
					CHARACTER = prev
				}
			}
		}
	}
}

# ROOT
# RECEIVER
gm1_valid_for_transfer_prisoner_interaction_trigger_strict = {
	gm1_valid_for_transfer_prisoner_interaction_trigger_basic = yes
	has_recently_undergone_interaction = no
	OR = {
		$RECEIVER$ = {
			NOT = { likes_character_trigger = { CHARACTER = prev } }
		}
		has_any_bad_relationship_with_character_trigger = {
			CHARACTER = $RECEIVER$
		}
		has_any_worst_bad_relationship_with_character_trigger = {
			CHARACTER = $RECEIVER$
		}
	}
	is_of_major_or_minor_interest_trigger = {
		CHARACTER = $RECEIVER$
	}
	## Don't bother with insignificant fucks.
	has_no_real_status_trigger = no
	has_no_particular_noble_roots_trigger = no
}

gm1_valid_for_transfer_prisoner_interaction_action_shared_trigger = {
	NOT = { is_allied_to = root }
}

gm1_valid_for_transfer_prisoner_interaction_offer_action_trigger = {
	gm1_valid_for_transfer_prisoner_interaction_action_shared_trigger = yes

	root = {
		any_prisoner = {
			count >= 1
			gm1_valid_for_transfer_prisoner_interaction_trigger = { 
				SENDER = $SENDER$
				RECEIVER = $RECEIVER$
			}
			save_temporary_scope_as = prisoner
		}
		is_character_interaction_potentially_accepted = {
			interaction = offer_prisoner_interaction
			recipient = $RECEIVER$
			secondary_actor = scope:prisoner
		}
	}
}